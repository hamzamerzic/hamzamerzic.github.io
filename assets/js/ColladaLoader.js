THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"Anonymous",load:function(e,t,r,a){var n=this,i=void 0===n.path?THREE.LoaderUtils.extractUrlBase(e):n.path;new THREE.FileLoader(n.manager).load(e,(function(e){t(n.parse(e,i))}),r,a)},setPath:function(e){this.path=e},options:{set convertUpAxis(e){}},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function r(e,t){for(var r=[],a=e.childNodes,n=0,i=a.length;n<i;n++){var s=a[n];s.nodeName===t&&r.push(s)}return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=t[a];return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=parseFloat(t[a]);return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=parseInt(t[a]);return r}function s(e){return e.substring(1)}function o(){return"three_default_"+dt++}function c(e){return 0===Object.keys(e).length}function u(e){return{unit:d(r(e,"unit")[0]),upAxis:l(r(e,"up_axis")[0])}}function d(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function l(e){return void 0!==e?e.textContent:"Y_UP"}function f(e,t,a,n){var i=r(e,t)[0];if(void 0!==i)for(var s=r(i,a),o=0;o<s.length;o++)n(s[o])}function h(e,t){for(var r in e){e[r].build=t(e[r])}}function m(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){for(var t={sources:{},samplers:{},channels:{}},r=0,a=e.childNodes.length;r<a;r++){var n,i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":n=i.getAttribute("id"),t.sources[n]=ge(i);break;case"sampler":n=i.getAttribute("id"),t.samplers[n]=v(i);break;case"channel":n=i.getAttribute("target"),t.channels[n]=g(i)}}lt.animations[e.getAttribute("id")]=t}function v(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"input"===n.nodeName){var i=s(n.getAttribute("source")),o=n.getAttribute("semantic");t.inputs[o]=i}}return t}function g(e){var t={},r=e.getAttribute("target").split("/"),a=r.shift(),n=r.shift(),i=-1!==n.indexOf("("),o=-1!==n.indexOf(".");if(o)r=n.split("."),n=r.shift(),t.member=r.shift();else if(i){var c=n.split("(");n=c.shift();for(var u=0;u<c.length;u++)c[u]=parseInt(c[u].replace(/\)/,""));t.indices=c}return t.id=a,t.sid=n,t.arraySyntax=i,t.memberSyntax=o,t.sampler=s(e.getAttribute("source")),t}function b(e){var t=[],r=e.channels,a=e.samplers,n=e.sources;for(var i in r)if(r.hasOwnProperty(i)){var s=r[i],o=a[s.sampler],c=o.inputs.INPUT,u=o.inputs.OUTPUT;T(N(s,n[c],n[u]),t)}return t}function y(e){return m(lt.animations[e],b)}function N(e,t,r){var a,n,i,s,o,c,u=lt.nodes[e.id],d=Ke(u.id),l=u.transforms[e.sid],f=u.matrix.clone().transpose(),h={};if("matrix"===l)for(i=0,s=t.array.length;i<s;i++)if(a=t.array[i],n=i*r.stride,void 0===h[a]&&(h[a]={}),!0===e.arraySyntax){var m=r.array[n],p=e.indices[0]+4*e.indices[1];h[a][p]=m}else for(o=0,c=r.stride;o<c;o++)h[a][o]=r.array[n+o];var v=E(h,f);return{name:d.uuid,keyframes:v}}function E(e,t){function r(e,t){return e.time-t.time}var a=[];for(var n in e)a.push({time:parseFloat(n),value:e[n]});a.sort(r);for(var i=0;i<16;i++)A(a,i,t.elements[i]);return a}function T(e,t){for(var r=e.keyframes,a=e.name,n=[],i=[],s=[],o=[],c=0,u=r.length;c<u;c++){var d=r[c],l=d.time,f=d.value;at.fromArray(f).transpose(),at.decompose(et,rt,tt),n.push(l),i.push(et.x,et.y,et.z),s.push(rt.x,rt.y,rt.z,rt.w),o.push(tt.x,tt.y,tt.z)}return i.length>0&&t.push(new THREE.VectorKeyframeTrack(a+".position",n,i)),s.length>0&&t.push(new THREE.QuaternionKeyframeTrack(a+".quaternion",n,s)),o.length>0&&t.push(new THREE.VectorKeyframeTrack(a+".scale",n,o)),t}function A(e,t,r){var a,n,i,s=!0;for(n=0,i=e.length;n<i;n++)void 0===(a=e[n]).value[t]?a.value[t]=null:s=!1;if(!0===s)for(n=0,i=e.length;n<i;n++)(a=e[n]).value[t]=r;else x(e,t)}function x(e,t){for(var r,a,n=0,i=e.length;n<i;n++){var s=e[n];if(null===s.value[t]){if(r=k(e,n,t),a=w(e,n,t),null===r){s.value[t]=a.value[t];continue}if(null===a){s.value[t]=r.value[t];continue}R(s,r,a,t)}}}function k(e,t,r){for(;t>=0;){var a=e[t];if(null!==a.value[r])return a;t--}return null}function w(e,t,r){for(;t<e.length;){var a=e[t];if(null!==a.value[r])return a;t++}return null}function R(e,t,r,a){r.time-t.time!=0?e.value[a]=(e.time-t.time)*(r.value[a]-t.value[a])/(r.time-t.time)+t.value[a]:e.value[a]=t.value[a]}function H(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"instance_animation"===n.nodeName)t.animations.push(s(n.getAttribute("url")))}lt.clips[e.getAttribute("id")]=t}function _(e){for(var t=[],r=e.name,a=e.end-e.start||-1,n=e.animations,i=0,s=n.length;i<s;i++)for(var o=y(n[i]),c=0,u=o.length;c<u;c++)t.push(o[c]);return new THREE.AnimationClip(r,a,t)}function C(e){return m(lt.clips[e],_)}function M(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=s(n.getAttribute("source")),t.skin=j(n);break;case"morph":t.id=s(n.getAttribute("source"))}}lt.controllers[e.getAttribute("id")]=t}function j(e){for(var t={sources:{}},r=0,a=e.childNodes.length;r<a;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=n(i.textContent);break;case"source":var s=i.getAttribute("id");t.sources[s]=ge(i);break;case"joints":t.joints=O(i);break;case"vertex_weights":t.vertexWeights=q(i)}}return t}function O(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"input"===n.nodeName){var i=n.getAttribute("semantic"),o=s(n.getAttribute("source"));t.inputs[i]=o}}return t}function q(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var o=n.getAttribute("semantic"),c=s(n.getAttribute("source")),u=parseInt(n.getAttribute("offset"));t.inputs[o]={id:c,offset:u};break;case"vcount":t.vcount=i(n.textContent);break;case"v":t.v=i(n.textContent)}}return t}function I(e){var t={id:e.id},r=lt.geometries[t.id];return void 0!==e.skin&&(t.skin=S(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function S(e){function t(e,t){return t.weight-e.weight}var r,a,n,i=4,s={joints:[],indices:{array:[],stride:i},weights:{array:[],stride:i}},o=e.sources,c=e.vertexWeights,u=c.vcount,d=c.v,l=c.inputs.JOINT.offset,f=c.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],m=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[c.inputs.WEIGHT.id].array,v=0;for(r=0,n=u.length;r<n;r++){var g=u[r],b=[];for(a=0;a<g;a++){var y=d[v+l],N=p[d[v+f]];b.push({index:y,weight:N}),v+=2}for(b.sort(t),a=0;a<i;a++){var E=b[a];void 0!==E?(s.indices.array.push(E.index),s.weights.array.push(E.weight)):(s.indices.array.push(0),s.weights.array.push(0))}}for(s.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose(),r=0,n=h.array.length;r<n;r++){var T=h.array[r],A=(new THREE.Matrix4).fromArray(m.array,r*m.stride).transpose();s.joints.push({name:T,boneInverse:A})}return s}function L(e){return m(lt.controllers[e],I)}function F(e){var t={init_from:r(e,"init_from")[0].textContent};lt.images[e.getAttribute("id")]=t}function B(e){return void 0!==e.build?e.build:e.init_from}function V(e){return m(lt.images[e],B)}function P(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"profile_COMMON"===n.nodeName)t.profile=U(n)}lt.effects[e.getAttribute("id")]=t}function U(e){for(var t={surfaces:{},samplers:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":z(n,t);break;case"technique":t.technique=D(n);break;case"extra":t.extra=Y(n)}}return t}function z(e,t){for(var r=e.getAttribute("sid"),a=0,n=e.childNodes.length;a<n;a++){var i=e.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[r]=W(i);break;case"sampler2D":t.samplers[r]=G(i)}}}function W(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"init_from"===n.nodeName)t.init_from=n.textContent}return t}function G(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"source"===n.nodeName)t.source=n.textContent}return t}function D(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=J(n)}}return t}function J(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparency":t[n.nodeName]=K(n);break;case"transparent":t[n.nodeName]={opaque:n.getAttribute("opaque"),data:K(n)}}}return t}function K(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"color":t[i.nodeName]=n(i.textContent);break;case"float":t[i.nodeName]=parseFloat(i.textContent);break;case"texture":t[i.nodeName]={id:i.getAttribute("texture"),extra:X(i)}}}return t}function X(e){for(var t={technique:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"extra"===n.nodeName)Z(n,t)}return t}function Z(e,t){for(var r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"technique"===n.nodeName)Q(n,t)}}function Q(e,t){for(var r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function Y(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"technique"===n.nodeName)t.technique=$(n)}return t}function $(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"double_sided"===n.nodeName)t[n.nodeName]=parseInt(n.textContent)}return t}function ee(e){return e}function te(e){return m(lt.effects[e],ee)}function re(e){for(var t={name:e.getAttribute("name")},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"instance_effect"===n.nodeName)t.url=s(n.getAttribute("url"))}lt.materials[e.getAttribute("id")]=t}function ae(e){function t(e){var t,r=a.profile.samplers[e.id];void 0!==r?t=V(a.profile.surfaces[r.source].init_from):t=V(e.id);if(void 0!==t){var n=ot.load(t),i=e.extra;if(void 0!==i&&void 0!==i.technique&&!1===c(i.technique)){var s=i.technique;n.wrapS=s.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=s.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.offset.set(s.offsetU||0,s.offsetV||0),n.repeat.set(s.repeatU||1,s.repeatV||1)}else n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping;return n}return null}var r,a=te(e.url),n=a.profile.technique,i=a.profile.extra;switch(n.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}r.name=e.name;var s=n.parameters;for(var o in s){var u=s[o];switch(o){case"diffuse":u.color&&r.color.fromArray(u.color),u.texture&&(r.map=t(u.texture));break;case"specular":u.color&&r.specular&&r.specular.fromArray(u.color),u.texture&&(r.specularMap=t(u.texture));break;case"shininess":u.float&&r.shininess&&(r.shininess=u.float);break;case"emission":u.color&&r.emissive&&r.emissive.fromArray(u.color)}}var d=s.transparent,l=s.transparency;if(void 0===l&&d&&(l={float:1}),void 0===d&&l&&(d={opaque:"A_ONE",data:{color:[1,1,1,1]}}),d&&l)if(d.data.texture)r.alphaMap=t(d.data.texture),r.transparent=!0;else{var f=d.data.color;switch(d.opaque){case"A_ONE":r.opacity=f[3]*l.float;break;case"RGB_ZERO":r.opacity=1-f[0]*l.float;break;case"A_ZERO":r.opacity=1-f[3]*l.float;break;case"RGB_ONE":r.opacity=f[0]*l.float}r.opacity<1&&(r.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(r.side=THREE.DoubleSide),r}function ne(e){return m(lt.materials[e],ae)}function ie(e){for(var t={name:e.getAttribute("name")},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"optics"===n.nodeName)t.optics=se(n)}lt.cameras[e.getAttribute("id")]=t}function se(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if("technique_common"===r.nodeName)return oe(r)}return{}}function oe(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"perspective":case"orthographic":t.technique=a.nodeName,t.parameters=ce(a)}}return t}function ce(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[a.nodeName]=parseFloat(a.textContent)}}return t}function ue(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,a=e.optics.parameters.xmag,n=e.optics.parameters.aspect_ratio;a=void 0===a?r*n:a,r=void 0===r?a/n:r,a*=.5,r*=.5,t=new THREE.OrthographicCamera(-a,a,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function de(e){var t=lt.cameras[e];return void 0!==t?m(t,ue):null}function le(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType&&"technique_common"===n.nodeName)t=fe(n)}lt.lights[e.getAttribute("id")]=t}function fe(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=he(n)}}return t}function he(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"color":var s=n(i.textContent);t.color=(new THREE.Color).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":var o=parseFloat(i.textContent);t.distance=o?Math.sqrt(1/o):0}}return t}function me(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function pe(e){var t=lt.lights[e];return void 0!==t?m(t,me):null}function ve(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},a=r(e,"mesh")[0];if(void 0!==a){for(var n=0;n<a.childNodes.length;n++){var i=a.childNodes[n];if(1===i.nodeType){var s=i.getAttribute("id");switch(i.nodeName){case"source":t.sources[s]=ge(i);break;case"vertices":t.vertices=be(i);break;case"polygons":break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ye(i))}}}lt.geometries[e.getAttribute("id")]=t}}function ge(e){for(var t={array:[],stride:3},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"float_array":t.array=n(s.textContent);break;case"Name_array":t.array=a(s.textContent);break;case"technique_common":var o=r(s,"accessor")[0];void 0!==o&&(t.stride=parseInt(o.getAttribute("stride")))}}return t}function be(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];1===a.nodeType&&(t[a.getAttribute("semantic")]=s(a.getAttribute("source")))}return t}function ye(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var o=s(n.getAttribute("source")),c=n.getAttribute("semantic"),u=parseInt(n.getAttribute("offset"));t.inputs[c]={id:o,offset:u},t.stride=Math.max(t.stride,u+1);break;case"vcount":t.vcount=i(n.textContent);break;case"p":t.p=i(n.textContent)}}return t}function Ne(e){for(var t={},r=0;r<e.length;r++){var a=e[r];void 0===t[a.type]&&(t[a.type]=[]),t[a.type].push(a)}return t}function Ee(e){var t={},r=e.sources,a=e.vertices,n=e.primitives;if(0===n.length)return{};var i=Ne(n);for(var s in i)t[s]=Te(i[s],r,a);return t}function Te(e,t,r){for(var a={},n={array:[],stride:0},i={array:[],stride:0},s={array:[],stride:0},o={array:[],stride:0},c={array:[],stride:4},u={array:[],stride:4},d=new THREE.BufferGeometry,l=[],f=0,h=0,m=0;m<e.length;m++){var p=e[m],v=p.inputs,g=1;for(var b in p.vcount&&4===p.vcount[0]&&(g=2),h="lines"===p.type||"linestrips"===p.type?2*p.count:3*p.count*g,d.addGroup(f,h,m),f+=h,p.material&&l.push(p.material),v){var y=v[b];switch(b){case"VERTEX":for(var N in r){var E=r[N];switch(N){case"POSITION":Ae(p,t[E],y.offset,n.array),n.stride=t[E].stride,t.skinWeights&&t.skinIndices&&(Ae(p,t.skinIndices,y.offset,c.array),Ae(p,t.skinWeights,y.offset,u.array));break;case"NORMAL":Ae(p,t[E],y.offset,i.array),i.stride=t[E].stride;break;case"COLOR":Ae(p,t[E],y.offset,o.array),o.stride=t[E].stride;break;case"TEXCOORD":Ae(p,t[E],y.offset,s.array),s.stride=t[E].stride}}break;case"NORMAL":Ae(p,t[y.id],y.offset,i.array),i.stride=t[y.id].stride;break;case"COLOR":Ae(p,t[y.id],y.offset,o.array),o.stride=t[y.id].stride;break;case"TEXCOORD":Ae(p,t[y.id],y.offset,s.array),s.stride=t[y.id].stride}}}return n.array.length>0&&d.addAttribute("position",new THREE.Float32BufferAttribute(n.array,n.stride)),i.array.length>0&&d.addAttribute("normal",new THREE.Float32BufferAttribute(i.array,i.stride)),o.array.length>0&&d.addAttribute("color",new THREE.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&d.addAttribute("uv",new THREE.Float32BufferAttribute(s.array,s.stride)),c.array.length>0&&d.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c.array,c.stride)),u.array.length>0&&d.addAttribute("skinWeight",new THREE.Float32BufferAttribute(u.array,u.stride)),a.data=d,a.type=e[0].type,a.materialKeys=l,a}function Ae(e,t,r,a){function n(e){for(var t=i[e+r]*d,n=t+d;t<n;t++)a.push(u[t])}var i=e.p,s=e.stride,o=e.vcount,c=0,u=t.array,d=t.stride;if(void 0!==e.vcount)for(var l=0,f=0,h=o.length;f<h;f++){var m=o[f];if(4===m){var p=l+1*s,v=l+2*s,g=l+3*s;n(l+0*s),n(p),n(g),n(p),n(v),n(g)}else if(3===m){p=l+1*s,v=l+2*s;n(l+0*s),n(p),n(v)}else c=Math.max(c,m);l+=s*m}else for(f=0,h=i.length;f<h;f+=s)n(f)}function xe(e){return m(lt.geometries[e],Ee)}function ke(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType&&"technique_common"===a.nodeName)He(a,t)}lt.kinematicsModels[e.getAttribute("id")]=t}function we(e){return void 0!==e.build?e.build:e}function Re(e){return m(lt.kinematicsModels[e],we)}function He(e,t){for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"joint":t.joints[a.getAttribute("sid")]=_e(a);break;case"link":t.links.push(Me(a))}}}function _e(e){for(var t,r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"prismatic":case"revolute":t=Ce(a)}}return t}function Ce(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"axis":var i=n(a.textContent);t.axis.fromArray(i);break;case"limits":var s=a.getElementsByTagName("max")[0],o=a.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(o.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function Me(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"attachment_full":t.attachments.push(je(a));break;case"matrix":case"translate":case"rotate":t.transforms.push(Oe(a))}}return t}function je(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"link":t.links.push(Me(a));break;case"matrix":case"translate":case"rotate":t.transforms.push(Oe(a))}}return t}function Oe(e){var t={type:e.nodeName},r=n(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.Math.degToRad(r[3])}return t}function qe(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType&&"bind_joint_axis"===a.nodeName)t.bindJointAxis.push(Ie(a))}lt.kinematicsScenes[s(e.getAttribute("url"))]=t}function Ie(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType&&"axis"===a.nodeName){var n=a.getElementsByTagName("param")[0];t.axis=n.textContent;var i=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=i.substr(0,i.length-1)}}return t}function Se(e){return void 0!==e.build?e.build:e}function Le(e){return m(lt.kinematicsScenes[e],Se)}function Fe(){function e(e,t){var r=t.getAttribute("name"),a=n.joints[e];s.traverse((function(n){n.name===r&&(c[e]={object:n,transforms:Be(t),joint:a,position:a.zeroPosition})}))}var t=Object.keys(lt.kinematicsModels)[0],r=Object.keys(lt.kinematicsScenes)[0],a=Object.keys(lt.visualScenes)[0];if(void 0!==t&&void 0!==r){for(var n=Re(t),i=Le(r),s=Qe(a),o=i.bindJointAxis,c={},u=0,d=o.length;u<d;u++){var l=o[u],f=it.querySelector('[sid="'+l.target+'"]');if(f){var h=f.parentElement;e(l.jointIndex,h)}}var m=new THREE.Matrix4;ut={joints:n&&n.joints,getJointValue:function(e){var t=c[e];if(t)return t.position},setJointValue:function(e,t){var r=c[e];if(r){var a=r.joint;if(t>a.limits.max||t<a.limits.min);else if(a.static);else{var n=r.object,i=a.axis,s=r.transforms;at.identity();for(var o=0;o<s.length;o++){var u=s[o];if(u.sid&&-1!==u.sid.indexOf(e))switch(a.type){case"revolute":at.multiply(m.makeRotationAxis(i,THREE.Math.degToRad(t)));break;case"prismatic":at.multiply(m.makeTranslation(i.x*t,i.y*t,i.z*t))}else switch(u.type){case"matrix":at.multiply(u.obj);break;case"translate":at.multiply(m.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":at.scale(u.obj);break;case"rotate":at.multiply(m.makeRotationAxis(u.obj,u.angle))}}n.matrix.copy(at),n.matrix.decompose(n.position,n.quaternion,n.scale),c[e].position=t}}}}}}function Be(e){for(var t=[],r=it.querySelector('[id="'+e.id+'"]'),a=0;a<r.childNodes.length;a++){var i=r.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"matrix":var s=n(i.textContent),o=(new THREE.Matrix4).fromArray(s).transpose();t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:o});break;case"translate":case"scale":s=n(i.textContent);var c=(new THREE.Vector3).fromArray(s);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:c});break;case"rotate":s=n(i.textContent),c=(new THREE.Vector3).fromArray(s);var u=THREE.Math.degToRad(s[3]);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:c,angle:u})}}return t}function Ve(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var a=t[r];!1===a.hasAttribute("id")&&a.setAttribute("id",o())}}function Pe(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"node":t.nodes.push(a.getAttribute("id")),Pe(a);break;case"instance_camera":t.instanceCameras.push(s(a.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ue(a));break;case"instance_light":t.instanceLights.push(s(a.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ue(a));break;case"instance_node":t.instanceNodes.push(s(a.getAttribute("url")));break;case"matrix":var i=n(a.textContent);t.matrix.multiply(at.fromArray(i).transpose()),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"translate":i=n(a.textContent);nt.fromArray(i),t.matrix.multiply(at.makeTranslation(nt.x,nt.y,nt.z)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"rotate":i=n(a.textContent);var o=THREE.Math.degToRad(i[3]);t.matrix.multiply(at.makeRotationAxis(nt.fromArray(i),o)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"scale":i=n(a.textContent);t.matrix.scale(nt.fromArray(i)),t.transforms[a.getAttribute("sid")]=a.nodeName}}return lt.nodes[t.id]=t,t}function Ue(e){for(var t={id:s(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"bind_material":for(var n=a.getElementsByTagName("instance_material"),i=0;i<n.length;i++){var o=n[i],c=o.getAttribute("symbol"),u=o.getAttribute("target");t.materials[c]=s(u)}break;case"skeleton":t.skeletons.push(s(a.textContent))}}return t}function ze(e,t){var r,a,n,i=[],s=[];for(r=0;r<e.length;r++){We(Ke(e[r]),t,i)}for(r=0;r<t.length;r++)for(a=0;a<i.length;a++)if((n=i[a]).bone.name===t[r].name){s[r]=n,n.processed=!0;break}for(r=0;r<i.length;r++)!1===(n=i[r]).processed&&(s.push(n),n.processed=!0);var o=[],c=[];for(r=0;r<s.length;r++)n=s[r],o.push(n.bone),c.push(n.boneInverse);return new THREE.Skeleton(o,c)}function We(e,t,r){e.traverse((function(e){if(!0===e.isBone){for(var a,n=0;n<t.length;n++){var i=t[n];if(i.name===e.name){a=i.boneInverse;break}}void 0===a&&(a=new THREE.Matrix4),r.push({bone:e,boneInverse:a,processed:!1})}}))}function Ge(e){for(var t=[],r=e.matrix,a=e.nodes,n=e.type,i=e.instanceCameras,s=e.instanceControllers,o=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes,d=0,l=a.length;d<l;d++)t.push(Ke(a[d]));for(d=0,l=i.length;d<l;d++){var f=de(i[d]);null!==f&&t.push(f.clone())}for(d=0,l=s.length;d<l;d++)for(var h=L((N=s[d]).id),m=Je(xe(h.id),N.materials),p=ze(N.skeletons,h.skin.joints),v=0,g=m.length;v<g;v++){var b;(b=m[v]).isSkinnedMesh&&(b.bind(p,h.skin.bindMatrix),b.normalizeSkinWeights()),t.push(b)}for(d=0,l=o.length;d<l;d++){var y=pe(o[d]);null!==y&&t.push(y.clone())}for(d=0,l=c.length;d<l;d++){var N;for(v=0,g=(m=Je(xe((N=c[d]).id),N.materials)).length;v<g;v++)t.push(m[v])}for(d=0,l=u.length;d<l;d++)t.push(Ke(u[d]).clone());if(0===a.length&&1===t.length)b=t[0];else{b="JOINT"===n?new THREE.Bone:new THREE.Group;for(d=0;d<t.length;d++)b.add(t[d])}return b.name="JOINT"===n?e.sid:e.name,b.matrix.copy(r),b.matrix.decompose(b.position,b.quaternion,b.scale),b}function De(e,t){for(var r=[],a=0,n=e.length;a<n;a++){var i=t[e[a]];r.push(ne(i))}return r}function Je(e,t){var r=[];for(var a in e){var n=e[a],i=De(n.materialKeys,t);0===i.length&&("lines"===a||"linestrips"===a?i.push(new THREE.LineBasicMaterial):i.push(new THREE.MeshPhongMaterial));var s=void 0!==n.data.attributes.skinIndex;if(s)for(var o=0,c=i.length;o<c;o++)i[o].skinning=!0;var u,d=1===i.length?i[0]:i;switch(a){case"lines":u=new THREE.LineSegments(n.data,d);break;case"linestrips":u=new THREE.Line(n.data,d);break;case"triangles":case"polylist":u=s?new THREE.SkinnedMesh(n.data,d):new THREE.Mesh(n.data,d)}r.push(u)}return r}function Ke(e){return m(lt.nodes[e],Ge)}function Xe(e){var t={name:e.getAttribute("name"),children:[]};Ve(e);for(var a=r(e,"node"),n=0;n<a.length;n++)t.children.push(Pe(a[n]));lt.visualScenes[e.getAttribute("id")]=t}function Ze(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,a=0;a<r.length;a++){var n=r[a];t.add(Ke(n.id))}return t}function Qe(e){return m(lt.visualScenes[e],Ze)}function Ye(e){return Qe(s(r(e,"instance_visual_scene")[0].getAttribute("url")))}function $e(){var e=lt.clips;if(!0===c(e)){if(!1===c(lt.animations)){var t=[];for(var r in lt.animations)for(var a=y(r),n=0,i=a.length;n<i;n++)t.push(a[n]);ct.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)ct.push(C(r))}var et=new THREE.Vector3,tt=new THREE.Vector3,rt=new THREE.Quaternion,at=new THREE.Matrix4,nt=new THREE.Vector3;if(0===e.length)return{scene:new THREE.Scene};var it=r((new DOMParser).parseFromString(e,"application/xml"),"COLLADA")[0],st=(it.getAttribute("version"),u(r(it,"asset")[0])),ot=new THREE.TextureLoader(this.manager);ot.setPath(t).setCrossOrigin(this.crossOrigin);var ct=[],ut={},dt=0,lt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};f(it,"library_animations","animation",p),f(it,"library_animation_clips","animation_clip",H),f(it,"library_controllers","controller",M),f(it,"library_images","image",F),f(it,"library_effects","effect",P),f(it,"library_materials","material",re),f(it,"library_cameras","camera",ie),f(it,"library_lights","light",le),f(it,"library_geometries","geometry",ve),f(it,"library_nodes","node",Pe),f(it,"library_visual_scenes","visual_scene",Xe),f(it,"library_kinematics_models","kinematics_model",ke),f(it,"scene","instance_kinematics_scene",qe),h(lt.animations,b),h(lt.clips,_),h(lt.controllers,I),h(lt.images,B),h(lt.effects,ee),h(lt.materials,ae),h(lt.cameras,ue),h(lt.lights,me),h(lt.geometries,Ee),h(lt.visualScenes,Ze),$e(),Fe();var ft=Ye(r(it,"scene")[0]);return"Z_UP"===st.upAxis&&(ft.rotation.x=-Math.PI/2),ft.scale.multiplyScalar(st.unit),{animations:ct,kinematics:ut,library:lt,scene:ft}}};