!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,n,s){const i=this,r=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n,r))}catch(t){s&&s(t),i.manager.itemError(e)}}),n,s)}parse(e,t){function n(e,t){const n=[],s=e.childNodes;for(let e=0,i=s.length;e<i;e++){const i=s[e];i.nodeName===t&&n.push(i)}return n}function s(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,s=t.length;e<s;e++)n[e]=t[e];return n}function i(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,s=t.length;e<s;e++)n[e]=parseFloat(t[e]);return n}function r(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,s=t.length;e<s;e++)n[e]=parseInt(t[e]);return n}function o(e){return e.substring(1)}function a(){return"three_default_"+At++}function c(e){return 0===Object.keys(e).length}function l(e){return{unit:u(n(e,"unit")[0]),upAxis:d(n(e,"up_axis")[0])}}function u(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function d(e){return void 0!==e?e.textContent:"Y_UP"}function f(e,t,s,i){const r=n(e,t)[0];if(void 0!==r){const e=n(r,s);for(let t=0;t<e.length;t++)i(e[t])}}function h(e,t){for(const n in e){e[n].build=t(e[n])}}function m(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){const t={sources:{},samplers:{},channels:{}};let n=!1;for(let s=0,i=e.childNodes.length;s<i;s++){const i=e.childNodes[s];if(1!==i.nodeType)continue;let r;switch(i.nodeName){case"source":r=i.getAttribute("id"),t.sources[r]=Ne(i);break;case"sampler":r=i.getAttribute("id"),t.samplers[r]=g(i);break;case"channel":r=i.getAttribute("target"),t.channels[r]=b(i);break;case"animation":p(i),n=!0}}!1===n&&(kt.animations[e.getAttribute("id")||THREE.MathUtils.generateUUID()]=t)}function g(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"input"===s.nodeName){const e=o(s.getAttribute("source")),n=s.getAttribute("semantic");t.inputs[n]=e}}return t}function b(e){const t={};let n=e.getAttribute("target").split("/");const s=n.shift();let i=n.shift();const r=-1!==i.indexOf("("),a=-1!==i.indexOf(".");if(a)n=i.split("."),i=n.shift(),t.member=n.shift();else if(r){const e=i.split("(");i=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=s,t.sid=i,t.arraySyntax=r,t.memberSyntax=a,t.sampler=o(e.getAttribute("source")),t}function y(e){const t=[],n=e.channels,s=e.samplers,i=e.sources;for(const e in n)if(n.hasOwnProperty(e)){const r=n[e],o=s[r.sampler],a=o.inputs.INPUT,c=o.inputs.OUTPUT;x(E(r,i[a],i[c]),t)}return t}function N(e){return m(kt.animations[e],y)}function E(e,t,n){const s=kt.nodes[e.id],i=tt(s.id),r=s.transforms[e.sid],o=s.matrix.clone().transpose();let a,c,l,u,d,f;const h={};if("matrix"===r)for(l=0,u=t.array.length;l<u;l++)if(a=t.array[l],c=l*n.stride,void 0===h[a]&&(h[a]={}),!0===e.arraySyntax){const t=n.array[c],s=e.indices[0]+4*e.indices[1];h[a][s]=t}else for(d=0,f=n.stride;d<f;d++)h[a][d]=n.array[c+d];const m=T(h,o);return{name:i.uuid,keyframes:m}}function T(e,t){function n(e,t){return e.time-t.time}const s=[];for(const t in e)s.push({time:parseFloat(t),value:e[t]});s.sort(n);for(let e=0;e<16;e++)A(s,e,t.elements[e]);return s}function x(e,t){const n=e.keyframes,s=e.name,i=[],r=[],o=[],a=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],s=t.time,c=t.value;ft.fromArray(c).transpose(),ft.decompose(lt,dt,ut),i.push(s),r.push(lt.x,lt.y,lt.z),o.push(dt.x,dt.y,dt.z,dt.w),a.push(ut.x,ut.y,ut.z)}return r.length>0&&t.push(new THREE.VectorKeyframeTrack(s+".position",i,r)),o.length>0&&t.push(new THREE.QuaternionKeyframeTrack(s+".quaternion",i,o)),a.length>0&&t.push(new THREE.VectorKeyframeTrack(s+".scale",i,a)),t}function A(e,t,n){let s,i,r,o=!0;for(i=0,r=e.length;i<r;i++)s=e[i],void 0===s.value[t]?s.value[t]=null:o=!1;if(!0===o)for(i=0,r=e.length;i<r;i++)s=e[i],s.value[t]=n;else k(e,t)}function k(e,t){let n,s;for(let i=0,r=e.length;i<r;i++){const r=e[i];if(null===r.value[t]){if(n=w(e,i,t),s=v(e,i,t),null===n){r.value[t]=s.value[t];continue}if(null===s){r.value[t]=n.value[t];continue}R(r,n,s,t)}}}function w(e,t,n){for(;t>=0;){const s=e[t];if(null!==s.value[n])return s;t--}return null}function v(e,t,n){for(;t<e.length;){const s=e[t];if(null!==s.value[n])return s;t++}return null}function R(e,t,n,s){n.time-t.time!=0?e.value[s]=(e.time-t.time)*(n.value[s]-t.value[s])/(n.time-t.time)+t.value[s]:e.value[s]=t.value[s]}function H(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"instance_animation"===s.nodeName)t.animations.push(o(s.getAttribute("url")))}kt.clips[e.getAttribute("id")]=t}function _(e){const t=[],n=e.name,s=e.end-e.start||-1,i=e.animations;for(let e=0,n=i.length;e<n;e++){const n=N(i[e]);for(let e=0,s=n.length;e<s;e++)t.push(n[e])}return new THREE.AnimationClip(n,s,t)}function C(e){return m(kt.clips[e],_)}function M(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"skin":t.id=o(s.getAttribute("source")),t.skin=O(s);break;case"morph":t.id=o(s.getAttribute("source"))}}kt.controllers[e.getAttribute("id")]=t}function O(e){const t={sources:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(s.textContent);break;case"source":const e=s.getAttribute("id");t.sources[e]=Ne(s);break;case"joints":t.joints=j(s);break;case"vertex_weights":t.vertexWeights=q(s)}}return t}function j(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"input"===s.nodeName){const e=s.getAttribute("semantic"),n=o(s.getAttribute("source"));t.inputs[e]=n}}return t}function q(e){const t={inputs:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"input":const e=s.getAttribute("semantic"),n=o(s.getAttribute("source")),i=parseInt(s.getAttribute("offset"));t.inputs[e]={id:n,offset:i};break;case"vcount":t.vcount=r(s.textContent);break;case"v":t.v=r(s.textContent)}}return t}function I(e){const t={id:e.id},n=kt.geometries[t.id];return void 0!==e.skin&&(t.skin=S(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function S(e){function t(e,t){return t.weight-e.weight}const n=4,s={joints:[],indices:{array:[],stride:n},weights:{array:[],stride:n}},i=e.sources,r=e.vertexWeights,o=r.vcount,a=r.v,c=r.inputs.JOINT.offset,l=r.inputs.WEIGHT.offset,u=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=i[r.inputs.WEIGHT.id].array;let h,m,p,g=0;for(h=0,p=o.length;h<p;h++){const e=o[h],i=[];for(m=0;m<e;m++){const e=a[g+c],t=f[a[g+l]];i.push({index:e,weight:t}),g+=2}for(i.sort(t),m=0;m<n;m++){const e=i[m];void 0!==e?(s.indices.array.push(e.index),s.weights.array.push(e.weight)):(s.indices.array.push(0),s.weights.array.push(0))}}for(e.bindShapeMatrix?s.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():s.bindMatrix=(new THREE.Matrix4).identity(),h=0,p=u.array.length;h<p;h++){const e=u.array[h],t=(new THREE.Matrix4).fromArray(d.array,h*d.stride).transpose();s.joints.push({name:e,boneInverse:t})}return s}function U(e){return m(kt.controllers[e],I)}function B(e){const t={init_from:n(e,"init_from")[0].textContent};kt.images[e.getAttribute("id")]=t}function F(e){return void 0!==e.build?e.build:e.init_from}function L(e){const t=kt.images[e];return void 0!==t?m(t,F):null}function V(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"profile_COMMON"===s.nodeName)t.profile=P(s)}kt.effects[e.getAttribute("id")]=t}function P(e){const t={surfaces:{},samplers:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"newparam":W(s,t);break;case"technique":t.technique=G(s);break;case"extra":t.extra=Y(s)}}return t}function W(e,t){const n=e.getAttribute("sid");for(let s=0,i=e.childNodes.length;s<i;s++){const i=e.childNodes[s];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[n]=z(i);break;case"sampler2D":t.samplers[n]=D(i)}}}function z(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"init_from"===s.nodeName)t.init_from=s.textContent}return t}function D(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"source"===s.nodeName)t.source=s.textContent}return t}function G(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=s.nodeName,t.parameters=J(s);break;case"extra":t.extra=Y(s)}}return t}function J(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[s.nodeName]=X(s);break;case"transparent":t[s.nodeName]={opaque:s.hasAttribute("opaque")?s.getAttribute("opaque"):"A_ONE",data:X(s)}}}return t}function X(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"color":t[s.nodeName]=i(s.textContent);break;case"float":t[s.nodeName]=parseFloat(s.textContent);break;case"texture":t[s.nodeName]={id:s.getAttribute("texture"),extra:K(s)}}}return t}function K(e){const t={technique:{}};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"extra"===s.nodeName)Z(s,t)}return t}function Z(e,t){for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"technique"===s.nodeName)Q(s,t)}}function Q(e,t){for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[s.nodeName]=parseFloat(s.textContent);break;case"wrapU":case"wrapV":"TRUE"===s.textContent.toUpperCase()?t.technique[s.nodeName]=1:"FALSE"===s.textContent.toUpperCase()?t.technique[s.nodeName]=0:t.technique[s.nodeName]=parseInt(s.textContent);break;case"bump":t[s.nodeName]=ee(s)}}}function Y(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"technique"===s.nodeName)t.technique=$(s)}return t}function $(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"double_sided":t[s.nodeName]=parseInt(s.textContent);break;case"bump":t[s.nodeName]=ee(s)}}return t}function ee(e){for(var t={},n=0,s=e.childNodes.length;n<s;n++){var i=e.childNodes[n];if(1===i.nodeType&&"texture"===i.nodeName)t[i.nodeName]={id:i.getAttribute("texture"),texcoord:i.getAttribute("texcoord"),extra:K(i)}}return t}function te(e){return e}function ne(e){return m(kt.effects[e],te)}function se(e){const t={name:e.getAttribute("name")};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"instance_effect"===s.nodeName)t.url=o(s.getAttribute("url"))}kt.materials[e.getAttribute("id")]=t}function ie(e){let t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));if(n=n.toLowerCase(),"tga"===n)t=Et;else t=Nt;return t}function re(e){function t(e){const t=n.profile.samplers[e.id];let s=null;if(void 0!==t){s=L(n.profile.surfaces[t.source].init_from)}else s=L(e.id);if(null!==s){const t=ie(s);if(void 0!==t){const n=t.load(s),i=e.extra;if(void 0!==i&&void 0!==i.technique&&!1===c(i.technique)){const e=i.technique;n.wrapS=e.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=e.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.offset.set(e.offsetU||0,e.offsetV||0),n.repeat.set(e.repeatU||1,e.repeatV||1)}else n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping;return n}return null}return null}const n=ne(e.url),s=n.profile.technique;let i;switch(s.type){case"phong":case"blinn":i=new THREE.MeshPhongMaterial;break;case"lambert":i=new THREE.MeshLambertMaterial;break;default:i=new THREE.MeshBasicMaterial}i.name=e.name||"";const r=s.parameters;for(const e in r){const n=r[e];switch(e){case"diffuse":n.color&&i.color.fromArray(n.color),n.texture&&(i.map=t(n.texture));break;case"specular":n.color&&i.specular&&i.specular.fromArray(n.color),n.texture&&(i.specularMap=t(n.texture));break;case"bump":n.texture&&(i.normalMap=t(n.texture));break;case"ambient":n.texture&&(i.lightMap=t(n.texture));break;case"shininess":n.float&&i.shininess&&(i.shininess=n.float);break;case"emission":n.color&&i.emissive&&i.emissive.fromArray(n.color),n.texture&&(i.emissiveMap=t(n.texture))}}let o=r.transparent,a=r.transparency;if(void 0===a&&o&&(a={float:1}),void 0===o&&a&&(o={opaque:"A_ONE",data:{color:[1,1,1,1]}}),o&&a)if(o.data.texture)i.transparent=!0;else{const e=o.data.color;switch(o.opaque){case"A_ONE":i.opacity=e[3]*a.float;break;case"RGB_ZERO":i.opacity=1-e[0]*a.float;break;case"A_ZERO":i.opacity=1-e[3]*a.float;break;case"RGB_ONE":i.opacity=e[0]*a.float}i.opacity<1&&(i.transparent=!0)}if(void 0!==s.extra&&void 0!==s.extra.technique){const e=s.extra.technique;for(const n in e){const s=e[n];switch(n){case"double_sided":i.side=1===s?THREE.DoubleSide:THREE.FrontSide;break;case"bump":i.normalMap=t(s.texture),i.normalScale=new THREE.Vector2(1,1)}}}return i}function oe(e){return m(kt.materials[e],re)}function ae(e){const t={name:e.getAttribute("name")};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"optics"===s.nodeName)t.optics=ce(s)}kt.cameras[e.getAttribute("id")]=t}function ce(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if("technique_common"===n.nodeName)return le(n)}return{}}function le(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"perspective":case"orthographic":t.technique=s.nodeName,t.parameters=ue(s)}}return t}function ue(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[s.nodeName]=parseFloat(s.textContent)}}return t}function de(e){let t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,s=e.optics.parameters.xmag;const i=e.optics.parameters.aspect_ratio;s=void 0===s?n*i:s,n=void 0===n?s/i:n,s*=.5,n*=.5,t=new THREE.OrthographicCamera(-s,s,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name||"",t}function fe(e){const t=kt.cameras[e];return void 0!==t?m(t,de):null}function he(e){let t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType&&"technique_common"===s.nodeName)t=me(s)}kt.lights[e.getAttribute("id")]=t}function me(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=s.nodeName,t.parameters=pe(s)}}return t}function pe(e){const t={};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"color":const e=i(s.textContent);t.color=(new THREE.Color).fromArray(e);break;case"falloff_angle":t.falloffAngle=parseFloat(s.textContent);break;case"quadratic_attenuation":const n=parseFloat(s.textContent);t.distance=n?Math.sqrt(1/n):0}}return t}function ge(e){let t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function be(e){const t=kt.lights[e];return void 0!==t?m(t,ge):null}function ye(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},s=n(e,"mesh")[0];if(void 0!==s){for(let e=0;e<s.childNodes.length;e++){const n=s.childNodes[e];if(1!==n.nodeType)continue;const i=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[i]=Ne(n);break;case"vertices":t.vertices=Ee(n);break;case"polygons":break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(Te(n))}}kt.geometries[e.getAttribute("id")]=t}}function Ne(e){const t={array:[],stride:3};for(let r=0;r<e.childNodes.length;r++){const o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=s(o.textContent);break;case"technique_common":const e=n(o,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function Ee(e){const t={};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];1===s.nodeType&&(t[s.getAttribute("semantic")]=o(s.getAttribute("source")))}return t}function Te(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"input":const e=o(s.getAttribute("source")),n=s.getAttribute("semantic"),i=parseInt(s.getAttribute("offset")),a=parseInt(s.getAttribute("set")),c=a>0?n+a:n;t.inputs[c]={id:e,offset:i},t.stride=Math.max(t.stride,i+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=r(s.textContent);break;case"p":t.p=r(s.textContent)}}return t}function xe(e){const t={};for(let n=0;n<e.length;n++){const s=e[n];void 0===t[s.type]&&(t[s.type]=[]),t[s.type].push(s)}return t}function Ae(e){let t=0;for(let n=0,s=e.length;n<s;n++){!0===e[n].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ke(e){const t={},n=e.sources,s=e.vertices,i=e.primitives;if(0===i.length)return{};const r=xe(i);for(const e in r){const i=r[e];Ae(i),t[e]=we(i,n,s)}return t}function we(e,t,n){const s={},i={array:[],stride:0},r={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:4},u={array:[],stride:4},d=new THREE.BufferGeometry,f=[];let h=0;for(let s=0;s<e.length;s++){const m=e[s],p=m.inputs;let g=0;switch(m.type){case"lines":case"linestrips":g=2*m.count;break;case"triangles":g=3*m.count;break;case"polylist":for(let e=0;e<m.count;e++){const t=m.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(t-2)}}}d.addGroup(h,g,s),h+=g,m.material&&f.push(m.material);for(const s in p){const d=p[s];switch(s){case"VERTEX":for(const s in n){const f=n[s];switch(s){case"POSITION":const n=i.array.length;if(ve(m,t[f],d.offset,i.array),i.stride=t[f].stride,t.skinWeights&&t.skinIndices&&(ve(m,t.skinIndices,d.offset,l.array),ve(m,t.skinWeights,d.offset,u.array)),!1===m.hasUV&&!0===e.uvsNeedsFix){const e=(i.array.length-n)/i.stride;for(let t=0;t<e;t++)o.array.push(0,0)}break;case"NORMAL":ve(m,t[f],d.offset,r.array),r.stride=t[f].stride;break;case"COLOR":ve(m,t[f],d.offset,c.array),c.stride=t[f].stride;break;case"TEXCOORD":ve(m,t[f],d.offset,o.array),o.stride=t[f].stride;break;case"TEXCOORD1":ve(m,t[f],d.offset,a.array),o.stride=t[f].stride}}break;case"NORMAL":ve(m,t[d.id],d.offset,r.array),r.stride=t[d.id].stride;break;case"COLOR":ve(m,t[d.id],d.offset,c.array),c.stride=t[d.id].stride;break;case"TEXCOORD":ve(m,t[d.id],d.offset,o.array),o.stride=t[d.id].stride;break;case"TEXCOORD1":ve(m,t[d.id],d.offset,a.array),a.stride=t[d.id].stride}}}return i.array.length>0&&d.setAttribute("position",new THREE.Float32BufferAttribute(i.array,i.stride)),r.array.length>0&&d.setAttribute("normal",new THREE.Float32BufferAttribute(r.array,r.stride)),c.array.length>0&&d.setAttribute("color",new THREE.Float32BufferAttribute(c.array,c.stride)),o.array.length>0&&d.setAttribute("uv",new THREE.Float32BufferAttribute(o.array,o.stride)),a.array.length>0&&d.setAttribute("uv2",new THREE.Float32BufferAttribute(a.array,a.stride)),l.array.length>0&&d.setAttribute("skinIndex",new THREE.Float32BufferAttribute(l.array,l.stride)),u.array.length>0&&d.setAttribute("skinWeight",new THREE.Float32BufferAttribute(u.array,u.stride)),s.data=d,s.type=e[0].type,s.materialKeys=f,s}function ve(e,t,n,s){function i(e){let t=r[e+n]*l;const i=t+l;for(;t<i;t++)s.push(c[t])}const r=e.p,o=e.stride,a=e.vcount,c=t.array,l=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=a.length;t<n;t++){const n=a[t];if(4===n){const t=e+1*o,n=e+2*o,s=e+3*o;i(e+0*o),i(t),i(s),i(t),i(n),i(s)}else if(3===n){const t=e+1*o,n=e+2*o;i(e+0*o),i(t),i(n)}else if(n>4)for(let t=1,s=n-2;t<=s;t++){const n=e+o*t,s=e+o*(t+1);i(e+0*o),i(n),i(s)}e+=o*n}}else for(let e=0,t=r.length;e<t;e+=o)i(e)}function Re(e){return m(kt.geometries[e],ke)}function He(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType&&"technique_common"===s.nodeName)Me(s,t)}kt.kinematicsModels[e.getAttribute("id")]=t}function _e(e){return void 0!==e.build?e.build:e}function Ce(e){return m(kt.kinematicsModels[e],_e)}function Me(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"joint":t.joints[s.getAttribute("sid")]=Oe(s);break;case"link":t.links.push(qe(s))}}}function Oe(e){let t;for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"prismatic":case"revolute":t=je(s)}}return t}function je(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"axis":const e=i(s.textContent);t.axis.fromArray(e);break;case"limits":const n=s.getElementsByTagName("max")[0],r=s.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(r.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function qe(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"attachment_full":t.attachments.push(Ie(s));break;case"matrix":case"translate":case"rotate":t.transforms.push(Se(s))}}return t}function Ie(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"link":t.links.push(qe(s));break;case"matrix":case"translate":case"rotate":t.transforms.push(Se(s))}}return t}function Se(e){const t={type:e.nodeName},n=i(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(n);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(n),t.angle=THREE.MathUtils.degToRad(n[3])}return t}function Ue(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType&&"rigid_body"===s.nodeName)t.rigidBodies[s.getAttribute("name")]={},Be(s,t.rigidBodies[s.getAttribute("name")])}kt.physicsModels[e.getAttribute("id")]=t}function Be(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType&&"technique_common"===s.nodeName)Fe(s,t)}}function Fe(e,t){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"inertia":t.inertia=i(s.textContent);break;case"mass":t.mass=i(s.textContent)[0]}}}function Le(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType&&"bind_joint_axis"===s.nodeName)t.bindJointAxis.push(Ve(s))}kt.kinematicsScenes[o(e.getAttribute("url"))]=t}function Ve(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1===s.nodeType&&"axis"===s.nodeName){const e=s.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substr(0,n.length-1)}}return t}function Pe(e){return void 0!==e.build?e.build:e}function We(e){return m(kt.kinematicsScenes[e],Pe)}function ze(){function e(e,t){const n=t.getAttribute("name"),s=i.joints[e];o.traverse((function(i){i.name===n&&(c[e]={object:i,transforms:De(t),joint:s,position:s.zeroPosition})}))}const t=Object.keys(kt.kinematicsModels)[0],n=Object.keys(kt.kinematicsScenes)[0],s=Object.keys(kt.visualScenes)[0];if(void 0===t||void 0===n)return;const i=Ce(t),r=We(n),o=rt(s),a=r.bindJointAxis,c={};for(let t=0,n=a.length;t<n;t++){const n=a[t],s=gt.querySelector('[sid="'+n.target+'"]');if(s){const t=s.parentElement;e(n.jointIndex,t)}}const l=new THREE.Matrix4;xt={joints:i&&i.joints,getJointValue:function(e){const t=c[e];if(t)return t.position},setJointValue:function(e,t){const n=c[e];if(n){const s=n.joint;if(t>s.limits.max||t<s.limits.min);else if(s.static);else{const i=n.object,r=s.axis,o=n.transforms;ft.identity();for(let n=0;n<o.length;n++){const i=o[n];if(i.sid&&-1!==i.sid.indexOf(e))switch(s.type){case"revolute":ft.multiply(l.makeRotationAxis(r,THREE.MathUtils.degToRad(t)));break;case"prismatic":ft.multiply(l.makeTranslation(r.x*t,r.y*t,r.z*t))}else switch(i.type){case"matrix":ft.multiply(i.obj);break;case"translate":ft.multiply(l.makeTranslation(i.obj.x,i.obj.y,i.obj.z));break;case"scale":ft.scale(i.obj);break;case"rotate":ft.multiply(l.makeRotationAxis(i.obj,i.angle))}}i.matrix.copy(ft),i.matrix.decompose(i.position,i.quaternion,i.scale),c[e].position=t}}}}}function De(e){const t=[],n=gt.querySelector('[id="'+e.id+'"]');for(let e=0;e<n.childNodes.length;e++){const s=n.childNodes[e];if(1!==s.nodeType)continue;let r,o;switch(s.nodeName){case"matrix":r=i(s.textContent);const e=(new THREE.Matrix4).fromArray(r).transpose();t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:e});break;case"translate":case"scale":r=i(s.textContent),o=(new THREE.Vector3).fromArray(r),t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:o});break;case"rotate":r=i(s.textContent),o=(new THREE.Vector3).fromArray(r);const n=THREE.MathUtils.degToRad(r[3]);t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:o,angle:n})}}return t}function Ge(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const n=t[e];!1===n.hasAttribute("id")&&n.setAttribute("id",a())}}function Je(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];if(1!==s.nodeType)continue;let r;switch(s.nodeName){case"node":t.nodes.push(s.getAttribute("id")),Je(s);break;case"instance_camera":t.instanceCameras.push(o(s.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Xe(s));break;case"instance_light":t.instanceLights.push(o(s.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Xe(s));break;case"instance_node":t.instanceNodes.push(o(s.getAttribute("url")));break;case"matrix":r=i(s.textContent),t.matrix.multiply(ft.fromArray(r).transpose()),t.transforms[s.getAttribute("sid")]=s.nodeName;break;case"translate":r=i(s.textContent),ht.fromArray(r),t.matrix.multiply(ft.makeTranslation(ht.x,ht.y,ht.z)),t.transforms[s.getAttribute("sid")]=s.nodeName;break;case"rotate":r=i(s.textContent);const e=THREE.MathUtils.degToRad(r[3]);t.matrix.multiply(ft.makeRotationAxis(ht.fromArray(r),e)),t.transforms[s.getAttribute("sid")]=s.nodeName;break;case"scale":r=i(s.textContent),t.matrix.scale(ht.fromArray(r)),t.transforms[s.getAttribute("sid")]=s.nodeName}}return et(t.id)||(kt.nodes[t.id]=t),t}function Xe(e){const t={id:o(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n];switch(s.nodeName){case"bind_material":const e=s.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const s=e[n],i=s.getAttribute("symbol"),r=s.getAttribute("target");t.materials[i]=o(r)}break;case"skeleton":t.skeletons.push(o(s.textContent))}}return t}function Ke(e,t){const n=[],s=[];let i,r,o;for(i=0;i<e.length;i++){const s=e[i];let r;if(et(s))r=tt(s),Ze(r,t,n);else if(it(s)){const e=kt.visualScenes[s].children;for(let s=0;s<e.length;s++){const i=e[s];if("JOINT"===i.type){Ze(tt(i.id),t,n)}}}}for(i=0;i<t.length;i++)for(r=0;r<n.length;r++)if(o=n[r],o.bone.name===t[i].name){s[i]=o,o.processed=!0;break}for(i=0;i<n.length;i++)o=n[i],!1===o.processed&&(s.push(o),o.processed=!0);const a=[],c=[];for(i=0;i<s.length;i++)o=s[i],a.push(o.bone),c.push(o.boneInverse);return new THREE.Skeleton(a,c)}function Ze(e,t,n){e.traverse((function(e){if(!0===e.isBone){let s;for(let n=0;n<t.length;n++){const i=t[n];if(i.name===e.name){s=i.boneInverse;break}}void 0===s&&(s=new THREE.Matrix4),n.push({bone:e,boneInverse:s,processed:!1})}}))}function Qe(e){const t=[],n=e.matrix,s=e.nodes,i=e.type,r=e.instanceCameras,o=e.instanceControllers,a=e.instanceLights,c=e.instanceGeometries,l=e.instanceNodes;for(let e=0,n=s.length;e<n;e++)t.push(tt(s[e]));for(let e=0,n=r.length;e<n;e++){const n=fe(r[e]);null!==n&&t.push(n.clone())}for(let e=0,n=o.length;e<n;e++){const n=o[e],s=U(n.id),i=$e(Re(s.id),n.materials),r=Ke(n.skeletons,s.skin.joints);for(let e=0,n=i.length;e<n;e++){const n=i[e];n.isSkinnedMesh&&(n.bind(r,s.skin.bindMatrix),n.normalizeSkinWeights()),t.push(n)}}for(let e=0,n=a.length;e<n;e++){const n=be(a[e]);null!==n&&t.push(n.clone())}for(let e=0,n=c.length;e<n;e++){const n=c[e],s=$e(Re(n.id),n.materials);for(let e=0,n=s.length;e<n;e++)t.push(s[e])}for(let e=0,n=l.length;e<n;e++)t.push(tt(l[e]).clone());let u;if(0===s.length&&1===t.length)u=t[0];else{u="JOINT"===i?new THREE.Bone:new THREE.Group;for(let e=0;e<t.length;e++)u.add(t[e])}return u.name="JOINT"===i?e.sid:e.name,u.matrix.copy(n),u.matrix.decompose(u.position,u.quaternion,u.scale),u}function Ye(e,t){const n=[];for(let s=0,i=e.length;s<i;s++){const i=t[e[s]];void 0===i?n.push(mt):n.push(oe(i))}return n}function $e(e,t){const n=[];for(const s in e){const i=e[s],r=Ye(i.materialKeys,t);0===r.length&&("lines"===s||"linestrips"===s?r.push(new THREE.LineBasicMaterial):r.push(new THREE.MeshPhongMaterial));const o=void 0!==i.data.attributes.skinIndex,a=1===r.length?r[0]:r;let c;switch(s){case"lines":c=new THREE.LineSegments(i.data,a);break;case"linestrips":c=new THREE.Line(i.data,a);break;case"triangles":case"polylist":c=o?new THREE.SkinnedMesh(i.data,a):new THREE.Mesh(i.data,a)}n.push(c)}return n}function et(e){return void 0!==kt.nodes[e]}function tt(e){return m(kt.nodes[e],Qe)}function nt(e){const t={name:e.getAttribute("name"),children:[]};Ge(e);const s=n(e,"node");for(let e=0;e<s.length;e++)t.children.push(Je(s[e]));kt.visualScenes[e.getAttribute("id")]=t}function st(e){const t=new THREE.Group;t.name=e.name;const n=e.children;for(let e=0;e<n.length;e++){const s=n[e];t.add(tt(s.id))}return t}function it(e){return void 0!==kt.visualScenes[e]}function rt(e){return m(kt.visualScenes[e],st)}function ot(e){return rt(o(n(e,"instance_visual_scene")[0].getAttribute("url")))}function at(){const e=kt.clips;if(!0===c(e)){if(!1===c(kt.animations)){const e=[];for(const t in kt.animations){const n=N(t);for(let t=0,s=n.length;t<s;t++)e.push(n[t])}Tt.push(new THREE.AnimationClip("default",-1,e))}}else for(const t in e)Tt.push(C(t))}function ct(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}const lt=new THREE.Vector3,ut=new THREE.Vector3,dt=new THREE.Quaternion,ft=new THREE.Matrix4,ht=new THREE.Vector3,mt=new THREE.MeshBasicMaterial({color:16711935});if(0===e.length)return{scene:new THREE.Scene};const pt=(new DOMParser).parseFromString(e,"application/xml"),gt=n(pt,"COLLADA")[0],bt=pt.getElementsByTagName("parsererror")[0];if(void 0!==bt){const e=n(bt,"div")[0];let t;return t=e?e.textContent:ct(bt),null}gt.getAttribute("version");const yt=l(n(gt,"asset")[0]),Nt=new THREE.TextureLoader(this.manager);let Et
;Nt.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Et=new THREE.TGALoader(this.manager),Et.setPath(this.resourcePath||t));const Tt=[];let xt={},At=0;const kt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};f(gt,"library_animations","animation",p),f(gt,"library_animation_clips","animation_clip",H),f(gt,"library_controllers","controller",M),f(gt,"library_images","image",B),f(gt,"library_effects","effect",V),f(gt,"library_materials","material",se),f(gt,"library_cameras","camera",ae),f(gt,"library_lights","light",he),f(gt,"library_geometries","geometry",ye),f(gt,"library_nodes","node",Je),f(gt,"library_visual_scenes","visual_scene",nt),f(gt,"library_kinematics_models","kinematics_model",He),f(gt,"library_physics_models","physics_model",Ue),f(gt,"scene","instance_kinematics_scene",Le),h(kt.animations,y),h(kt.clips,_),h(kt.controllers,I),h(kt.images,F),h(kt.effects,te),h(kt.materials,re),h(kt.cameras,de),h(kt.lights,ge),h(kt.geometries,ke),h(kt.visualScenes,st),at(),ze();const wt=ot(n(gt,"scene")[0]);return wt.animations=Tt,"Z_UP"===yt.upAxis&&wt.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),wt.scale.multiplyScalar(yt.unit),{get animations(){return Tt},kinematics:xt,library:kt,scene:wt}}}THREE.ColladaLoader=e}();